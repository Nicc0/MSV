/*
 *   _Minecraft_Skin_Viewer_v. 1.0.0 ___  
 *  |"  \   /"  |/"       )"  \ . . /" :)  License: MIT/GPL2
 *  |:  .\ /.   (:  .\___/ \   \ ../   /    Author: http://nicc0.pl
 *  |     V.    |\___    \ .\.  \ /   /.   Website: http://nicc0.github.io
 *  |: \ .   /  |.___)   .|: \   V.  /:       Docs: http://nicc0.github.io/msv
 *  |.  \   /:  |/"  \   :| . \    ./         Repo: http://github.com/nicc0/msv
 *  |___|\_/|___(________/ .  .\___/.JS     Issues: http://github.com/nicc0/msv/issues
 *              by Daniel "Nicc0" Tecza
 */
var MSV=MSV||function(a){"use strict";function z(a,b){f.load(a.indexOf(".png")!==-1?a:a+b+".png",D)}function A(a){var b=document.createElement("canvas");b.width=64,b.height=64;var c=b.getContext("2d");return c.drawImage(a,0,0),C(c),B(c),b.toDataURL()}function B(a){for(var e,b=a.getImageData(0,0,1,1).data[0],c=[56,48,32,48,40,40],d=c.length;d--;){var f=4==d||3==d?0:8,g=c[d],h=f,i=a.getImageData(h,g,8,8).data;for(g=0;g<8;g++)for(h=0;h<8;h++)e=4*(h+8*g),(i[e]==b&&i[e+1]==b&&i[e+2]==b||0!=i[e+3])&&a.clearRect(c[d],f,8,8)}}function C(a){for(var b=[4,20,8,24,0,24,4,20,8,16,12,28,44,36,48,40,40,40,44,36,48,32,52,44],c=0;c<b.length;){for(var d=[0,2,12,14].indexOf(c)!=-1,e=4,f=d?4:12,g=a.getImageData(b[c++],d?16:20,e,f),h=0;h<2;h++)for(var i=0;i<f;i++)for(var j=0,k=4*(h+i*e),l=4*(e-h-1+i*e);j<4;j++){var m=g.data[k+j],n=g.data[l+j];g.data[k+j]=n,g.data[l+j]=m}a.putImageData(g,b[c++],d?48:52)}}function D(a){32==a.image.height&&(a.image.height=64,a.image.src=A(a.image)),p=a,p.magFilter=THREE.NearestFilter,p.minFilter=THREE.NearestMipMapNearestFilter,x?(v.map=p,w.map=p,v.needsUpdate=!0,w.needsUpdate=!0):(v=new THREE.MeshBasicMaterial({map:p,side:THREE.FrontSide}),w=new THREE.MeshBasicMaterial({map:p,transparent:!0,opacity:1,alphaTest:.5,side:THREE.DoubleSide}),G(),H(),x=!0),M()}function E(a){return x?(console.error("Minecraft Skin Viewer is initialized!"),!0):"undefined"==typeof THREE?(console.error("Three.js is required to run Minecraft Skin Viewer!"),!0):a?a.indexOf(".png")===-1&&"/"!=a.slice(-1)&&(console.error("URL is incorrect!"),!0):(console.error("URL in constructor is required!"),!0)}function F(a,b,c,d,e,f,g,h){for(var i=[],j=0;j<b.length;j++){i[j]=[];for(var k=0;k<4;k++)i[j][k]=new THREE.Vector2(b[j][2*k],b[j][2*k+1])}var m=new THREE.BoxGeometry(c,d,e,0,0,0);m.faceVertexUvs[0]=[];for(var j=0,n=2*j!=6;j<b.length;j++)m.faceVertexUvs[0][2*j]=[i[j][n?3:0],i[j][n?0:3],i[j][n?2:1]],m.faceVertexUvs[0][2*j+1]=[i[j][n?0:3],i[j][n?1:2],i[j][n?2:1]];var o=new THREE.Mesh(m,f);o.name=a,o.position.y=g,o.position.x=h,l.add(o)}function G(){}function H(){F("head",[[.25,.75,.375,.75,.375,.875,.25,.875],[0,.75,.125,.75,.125,.875,0,.875],[.125,.875,.25,.875,.25,1,.125,1],[.25,.875,.375,.875,.375,1,.25,1],[.125,.75,.25,.75,.25,.875,.125,.875],[.375,.75,.5,.75,.5,.875,.375,.875]],8,8,8,v,28,0),F("body",[[.4375,.5,.5,.5,.5,.6875,.4375,.6875],[.25,.5,.3125,.5,.3125,.6875,.25,.6875],[.3125,.6875,.4375,.6875,.4375,.75,.3125,.75],[.4375,.6875,.5625,.6875,.5625,.75,.4375,.75],[.3125,.5,.4375,.5,.4375,.6875,.3125,.6875],[.5,.5,.625,.5,.625,.6875,.5,.6875]],8,12,4,v,18,0),F("leftArm",[[.75,.5,.8125,.5,.8125,.6875,.75,.6875],[.625,.5,.6875,.5,.6875,.6875,.625,.6875],[.6875,.6875,.75,.6875,.75,.75,.6875,.75],[.75,.6875,.8125,.6875,.8125,.75,.75,.75],[.6875,.5,.75,.5,.75,.6875,.6875,.6875],[.8125,.5,.875,.5,.875,.6875,.8125,.6875]],4,12,4,v,18,-6),F("rightArm",[[.625,0,.6875,0,.6875,.1875,.625,.1875],[.5,0,.5625,0,.5625,.1875,.5,.1875],[.5625,.1875,.625,.1875,.625,.25,.5625,.25],[.625,.1875,.6875,.1875,.6875,.25,.625,.25],[.5625,0,.625,0,.625,.1875,.5625,.1875],[.6875,0,.75,0,.75,.1875,.6875,.1875]],4,12,4,v,18,6),F("leftLeg",[[.125,.5,.1875,.5,.1875,.6875,.125,.6875],[0,.5,.0625,.5,.0625,.6875,0,.6875],[.0625,.6875,.125,.6875,.125,.75,.0625,.75],[.125,.6875,.1875,.6875,.1875,.75,.125,.75],[.0625,.5,.125,.5,.125,.6875,.0625,.6875],[.1875,.5,.25,.5,.25,.6875,.1875,.6875]],4,12,4,v,6,-2),F("rightLeg",[[.375,0,.4375,0,.4375,.1875,.375,.1875],[.25,0,.3125,0,.3125,.1875,.25,.1875],[.3125,.1875,.375,.1875,.375,.25,.3125,.25],[.375,.1875,.4375,.1875,.4375,.25,.375,.25],[.3125,0,.375,0,.375,.1875,.3125,.1875],[.4375,0,.5,0,.5,.1875,.4375,.1875]],4,12,4,v,6,2),F("headOverlay",[[.75,.75,.875,.75,.875,.875,.75,.875],[.5,.75,.625,.75,.625,.875,.5,.875],[.625,.875,.75,.875,.75,1,.625,1],[.75,.875,.875,.875,.875,1,.75,1],[.625,.75,.75,.75,.75,.875,.625,.875],[.875,.75,1,.75,1,.875,.875,.875]],9,9,9,w,28,0),F("bodyOverlay",[[.4375,.25,.5,.25,.5,.4375,.4375,.4375],[.25,.25,.3125,.25,.3125,.4375,.25,.4375],[.3125,.4375,.4375,.4375,.4375,.5,.3125,.5],[.4375,.4375,.5625,.4375,.5625,.5,.4375,.5],[.3125,.25,.4375,.25,.4375,.4375,.3125,.4375],[.5,.25,.625,.25,.625,.4375,.5,.4375]],9,13.5,4.5,w,18,0),F("leftArmOverlay",[[.75,.25,.8125,.25,.8125,.4375,.75,.4375],[.625,.25,.6875,.25,.6875,.4375,.625,.4375],[.6875,.4375,.75,.4375,.75,.5,.6875,.5],[.75,.4375,.8125,.4375,.8125,.5,.75,.5],[.6875,.25,.75,.25,.75,.4375,.6875,.4375],[.8125,.25,.875,.25,.875,.4375,.8125,.4375]],4.5,13.5,4.5,w,18,-6),F("rightArmOverlay",[[.875,0,.9375,0,.9375,.1875,.875,.1875],[.75,0,.8125,0,.8125,.1875,.75,.1875],[.8125,.1875,.875,.1875,.875,.25,.8125,.25],[.875,.1875,.9375,.1875,.9375,.25,.875,.25],[.8125,0,.875,0,.875,.1875,.8125,.1875],[.9375,0,1,0,1,.1875,.9375,.1875]],4.5,13.5,4.5,w,18,6),F("leftLegOverlay",[[.125,.25,.1875,.25,.1875,.4375,.125,.4375],[0,.25,.0625,.25,.0625,.4375,0,.4375],[.0625,.4375,.125,.4375,.125,.5,.0625,.5],[.125,.4375,.1875,.4375,.1875,.5,.125,.5],[.0625,.25,.125,.25,.125,.4375,.0625,.4375],[.1875,.25,.25,.25,.25,.4375,.1875,.4375]],4.5,13.5,4.5,w,6,-2),F("rightLegOverlay",[[.125,0,.1875,0,.1875,.1875,.125,.1875],[0,0,.0625,0,.0625,.1875,0,.1875],[.0625,.1875,.125,.1875,.125,.25,.0625,.25],[.125,.1875,.1875,.1875,.1875,.25,.125,.25],[.0625,0,.125,0,.125,.1875,.0625,.1875],[.1875,0,.25,0,.25,.1875,.1875,.1875]],4.5,13.5,4.5,w,6,2)}function I(a){a.preventDefault(),h=!0,s=r,u=t,i.x=a.clientX,i.y=a.clientY}function J(a){a.preventDefault(),h&&(r=-(.5*(a.clientX-i.x))+s,t=.5*(a.clientY-i.y)+u,t=Math.min(180,Math.max(0,t)),k.position.x=q*Math.sin(r*Math.PI/360)*Math.cos(t*Math.PI/360),k.position.y=q*Math.sin(t*Math.PI/360),k.position.z=q*Math.cos(r*Math.PI/360)*Math.cos(t*Math.PI/360),k.lookAt(new THREE.Vector3(a.clientX/m.domElement.width*2-1,2*-(a.clientY/m.domElement.height)+18,.5)),M())}function K(a){a.preventDefault(),h=!1,i.x=a.clientX-i.x,i.y=a.clientY-i.y,i.length()>5||M()}function L(a){var b=q;return q-=a.wheelDeltaY/20,q<40?void(q=b):(k.position.x=q*Math.sin(r*Math.PI/360)*Math.cos(t*Math.PI/360),k.position.y=q*Math.sin(t*Math.PI/360),k.position.z=q*Math.cos(r*Math.PI/360)*Math.cos(t*Math.PI/360),k.lookAt(new THREE.Vector3(a.clientX/m.domElement.width*2-1,2*-(a.clientY/m.domElement.height)+18,.5)),void M())}function M(){m.render(l,k)}var c,f,g,i,j,k,l,m,n,p,v,w,b=this,h=!1,q=100,r=45,s=45,t=60,u=60,x=!1;this.skinName=null,this.skinURL=a,this.setContainer=function(a){return c?void console.log("Container is defined! Ignored."):void(c=a)},this.setSkinURL=function(a){this.skinURL=a,x&&z(a,this.skinName)},this.setSkinName=function(a){this.skinName=a,x&&z(this.skinURL,a)},this.init=function(){if(!E(this.skinURL)){if(c=document.getElementById("msv"),!c||null==c)return void console.error("DOM Container for MSV is not defined!");l=new THREE.Scene,n=new THREE.Raycaster,i=new THREE.Vector2,f=new THREE.TextureLoader,f.crossOrigin="",k=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,1,1e4),k.position.x=q*Math.sin(r*Math.PI/360)*Math.cos(t*Math.PI/360),k.position.y=q*Math.sin(t*Math.PI/360),k.position.z=q*Math.cos(r*Math.PI/360)*Math.cos(t*Math.PI/360),k.lookAt(new THREE.Vector3(0,18,0));var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(-50,0,0)),a.vertices.push(new THREE.Vector3(50,0,0)),g=new THREE.LineBasicMaterial({color:0,opacity:.2});for(var d=0;d<=20;d++){var e=new THREE.Line(a,g);e.position.z=5*d-50,l.add(e);var e=new THREE.Line(a,g);e.position.x=5*d-50,e.rotation.y=90*Math.PI/180,l.add(e)}c.addEventListener("mousemove",J,!1),c.addEventListener("mousedown",I,!1),c.addEventListener("mouseup",K,!1),c.addEventListener("mousewheel",L,!1),j=document.querySelectorAll("[data-msv-skin]");for(var d=0;d<j.length;d++)0===d&&(this.skinName=j[d].getAttribute("data-msv-skin")),j[d].addEventListener("click",function(){var a=this.getAttribute("data-msv-skin");a.indexOf(".png")!==-1?b.skinURL=a:b.skinName=a,z(b.skinURL,b.skinName)},!1);if(this.skinURL.indexOf(".png")===-1&&null==this.skinName)return void console.error("Can't find any skin data!");z(this.skinURL,this.skinName),m=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),m.setPixelRatio(2),m.shadowMap.type=THREE.BasicShadowMap,m.setSize(window.innerWidth,window.innerHeight),c.appendChild(m.domElement)}}};
